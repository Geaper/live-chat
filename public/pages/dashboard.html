<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>AS Chat</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/4.4.95/css/materialdesignicons.min.css">
</head>
<body>
    <div id="navigation"></div>
        <div class="container-fluid">
            <div class="row" style="margin-top: 40px;">
                <div class="col-md-6">
                    <div class="card card-statistics">
                        <div class="card-body">
                            <div class="clearfix">
                            <div class="float-left">
                                <i class="mdi mdi-account text-danger icon-lg"></i>
                            </div>
                            <div class="float-right">
                                <p class="mb-0 text-right">Total Users</p>
                                <div class="fluid-container">
                                <h2 class="font-weight-medium text-right mb-0" id="totalUsers"></h2>
                                </div>
                            </div>
                            </div>
                            <p class="text-muted mt-3 mb-0">
                            <i class="mdi mdi-alert-octagon mr-1" aria-hidden="true"></i> Live Chat user counter </p>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card card-statistics">
                        <div class="card-body">
                            <div class="clearfix">
                            <div class="float-left">
                                <i class="mdi mdi-message text-primary icon-lg"></i>
                            </div>
                            <div class="float-right">
                                <p class="mb-0 text-right">Total Messages</p>
                                <div class="fluid-container">
                                <h2 class="font-weight-medium text-right mb-0" id="totalMessages"></h2>
                                </div>
                            </div>
                            </div>
                            <p class="text-muted mt-3 mb-0">
                            <i class="mdi mdi-alert-octagon mr-1" aria-hidden="true"></i> Live Chat message counter </p>
                        </div>
                    </div>
                </div>
            </div>     
            <hr>
            <div class="row">
                <div class="col-md-12">
                    <canvas id="canvas"></canvas>
                </div>
            </div>       
        </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js"></script>

    <script type="text/javascript">

        $(function(){
            $("#navigation").load("navigation.html"); 
            $("#footer").load("footer.html"); 
        });

         let socket = io('http://localhost:3000');

        socket.on('connect', () => {
            socket.on('previousMessages', function(messages) {
                let totalMessages = messages.length;
                $('#totalMessages').html(totalMessages);
            });

            let loggedUsers = [];
            socket.on('getUsers', function(users) {
                let totalUsers = users.length;
                $('#totalUsers').html(totalUsers);
            });
        });

        // Charts

        let chartColors = {
            red: 'rgb(255, 99, 132)',
            orange: 'rgb(255, 159, 64)',
            yellow: 'rgb(255, 205, 86)',
            green: 'rgb(75, 192, 192)',
            blue: 'rgb(54, 162, 235)',
            purple: 'rgb(153, 102, 255)',
            grey: 'rgb(201, 203, 207)'
        };

        function rand(min, max) {
            var seed = this._seed;
            min = min === undefined ? 0 : min;
            max = max === undefined ? 1 : max;
            this._seed = (seed * 9301 + 49297) % 233280;
            return min + (this._seed / 233280) * (max - min);
        }


        window.randomScalingFactor = function() {
		    return Math.round(rand(-100, 100));
	    };
      
        var MONTHS = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
		var config = {
			type: 'line',
			data: {
				labels: ['January', 'February', 'March', 'April', 'May', 'June', 'July'],
				datasets: [{
					label: 'My First dataset',
					backgroundColor: chartColors.red,
					borderColor: chartColors.red,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
					fill: false,
				}, {
					label: 'My Second dataset',
					fill: false,
					backgroundColor: chartColors.blue,
					borderColor: chartColors.blue,
					data: [
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor(),
						randomScalingFactor()
					],
				}]
			},
			options: {
				responsive: true,
				title: {
					display: true,
					text: 'Chart.js Line Chart'
				},
				tooltips: {
					mode: 'index',
					intersect: false,
				},
				hover: {
					mode: 'nearest',
					intersect: true
				},
				scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}]
				}
			}
		};

		window.onload = function() {
			var ctx = document.getElementById('canvas').getContext('2d');
            window.myLine = new Chart(ctx, config);
		};
	
    </script>
</body>
<div id="footer"></div>
</html>